---
title: "hobo_2023"
format: html
editor: source
---

## Load Packages

```{r}

if (!require(librarian)){
  install.packages("librarian")
  library(librarian)
}

# librarian downloads, if not already downloaded, and reads in needed packages
librarian::shelf(tidyverse, here, janitor, lubridate, RPostgres, rstudioapi, DBI, parsedate, stringr, hms,
                 anytime, terra, sp, rgdal, RWmisc, proj4, uuid)

```

## read in all .csv files
```{r}

# clear environment
rm(list=ls())

# slow method for reading csv files

filenames <- gsub("\\.csv$","", list.files(here("data", "hobo_2023", "all")))

for(i in filenames){
  assign(i, read_csv(here("data", "hobo_2023", "all", paste(i, ".csv", sep=""))))
}
```

## Panama

### Combine both Panama files raw
```{r}

raw_comb_panama <- rbind(`Panama_combined_Aug23-Dec23`, `Panama_combined_Nov22-Aug23`) %>% 
  clean_names()
 
```

### Clean and Pivot
```{r}

clean_panama <- raw_comb_panama %>% 
  select(!c(time_zone, study_area, hobo_name)) %>% 
  rename(temperature_c = temperature,
         light_lux = intensity_lux,
         relative_humidity = rh) %>% 
  mutate(height = str_replace(height, "-", "neg"),
         dew_point_c = NA,
         site = if_else(site == "AltosdePiedra", "altos_de_piedra", site),
         site = if_else(site == "Campestre", "hotel_campestre", site),
         site = if_else(site == "CerroNegro", "cerro_negro", site), # new
         site = if_else(site == "Rabbit", "rabbit_stream", site), # new
         site = if_else(site == "RioBlanco", "rio_blanco", site),
         site = if_else(site == "Tigrero", "rio_tigrero", site)) %>% 
  unite(height, c(location, height), sep = "_") %>% 
  pivot_wider(names_from = height, values_from = c(temperature_c, relative_humidity, dew_point_c, light_lux))

```


## Penn

### Raw penn
```{r}

raw_penn <- `PA_combined_May23â€“Jun23` %>% 
  clean_names() 

```

### Clean and Pivot
```{r}

clean_penn <- raw_penn %>% 
  select(!c(time_zone, study_area, hobo_name)) %>% 
  rename(temperature_c = temperature,
         light_lux = intensity_lux,
         relative_humidity = rh,
         dew_point_c = dew_point) %>% 
  mutate(height = str_replace(height, "-", "neg"),
         site = if_else(site == "Admin", "admin_pond", site),
         site = if_else(site == "Phelps", "phelps_pond", site),
         site = if_else(site == "RV", "rv_pond", site),
         site = if_else(site == "TW", "tryon_weber", site),
         site = if_else(site == "Vorisek", "vorisek_pond", site),
         site = if_else(site == "Wood", "wood_lab_pond", site),
         site = if_else(site == "Tuttle", "tuttle_pond", site))

penn_soil <- clean_penn %>% 
  filter(location == "soil") %>%
  rename(soil_temperature_c = temperature_c,
         soil_light_lux = light_lux,
         soil_relative_humidity = relative_humidity,
         soil_dew_point_c = dew_point_c) %>% 
  mutate(row = row_number()) %>%
  pivot_wider(names_from = height, values_from = c(soil_temperature_c, soil_light_lux, soil_relative_humidity, soil_dew_point_c)) %>% 
  select(!c(row, location))

penn_shade <- clean_penn %>% 
  filter(location == "shade") %>% 
  rename(shade_temperature_c = temperature_c,
         shade_light_lux = light_lux,
         shade_relative_humidity = relative_humidity,
         shade_dew_point_c = dew_point_c) %>% 
  mutate(row = row_number()) %>% 
  pivot_wider(names_from = height, values_from = c(shade_temperature_c, shade_relative_humidity, shade_dew_point_c, shade_light_lux))%>% 
  select(!c(row, location))

penn_water <- clean_penn %>% 
  filter(location=="water") %>%
  rename(water_temperature_c = temperature_c,
         water_light_lux = light_lux,
         water_relative_humidity = relative_humidity,
         water_dew_point_c = dew_point_c) %>% 
  mutate(row = row_number()) %>%
  pivot_wider(names_from = height, values_from = c(water_temperature_c, water_relative_humidity, water_dew_point_c, water_light_lux))%>% 
  select(!c(row, location))

penn_sun <- clean_penn %>% 
  filter(location == "sun") %>%
  rename(sun_temperature_c = temperature_c,
         sun_light_lux = light_lux,
         sun_relative_humidity = relative_humidity,
         sun_dew_point_c = dew_point_c) %>% 
  mutate(row = row_number()) %>%
  pivot_wider(names_from = height, values_from = c(sun_temperature_c, sun_relative_humidity, sun_dew_point_c, sun_light_lux))%>% 
  select(!c(row, location))

```


## SN

### Raw SN 
```{r}

raw_sn <- `SierraNevada_combined_Jul23-Oct23` %>% 
  clean_names()

```

### Clean and Pivot
```{r}

clean_sn <- raw_sn %>% 
  select(!c(time_zone, study_area, hobo_name)) %>% 
  rename(temperature_c = temperature,
         light_lux = intensity_lux,
         relative_humidity = rh,
         dew_point_c = dew_point) %>% 
  mutate(height = str_replace(height, "-", "neg"))

sn_soil <- clean_sn %>% 
  filter(location == "soil") %>% 
  mutate(row = row_number()) %>%
  rename(soil_temperature_c = temperature_c,
         soil_light_lux = light_lux,
         soil_relative_humidity = relative_humidity,
         soil_dew_point_c = dew_point_c) %>% 
  pivot_wider(names_from = height, values_from = c(soil_temperature_c, soil_light_lux, soil_relative_humidity, soil_dew_point_c)) %>% 
  select(!c(row, location))

sn_shade <- clean_sn %>% 
  filter(location == "shade") %>%
  mutate(row = row_number()) %>% 
  rename(shade_temperature_c = temperature_c,
         shade_light_lux = light_lux,
         shade_relative_humidity = relative_humidity,
         shade_dew_point_c = dew_point_c) %>% 
  pivot_wider(names_from = height, values_from = c(shade_temperature_c, shade_relative_humidity, shade_dew_point_c, shade_light_lux))%>% 
  select(!c(row, location))

sn_water <- clean_sn %>% 
  filter(location=="water") %>% 
  mutate(row = row_number()) %>%
  rename(water_temperature_c = temperature_c,
         water_light_lux = light_lux,
         water_relative_humidity = relative_humidity,
         water_dew_point_c = dew_point_c) %>% 
  pivot_wider(names_from = height, values_from = c(water_temperature_c, water_relative_humidity, water_dew_point_c, water_light_lux))%>% 
  select(!c(row, location))

sn_sun <- clean_sn %>% 
  filter(location == "sun") %>% 
  mutate(row = row_number()) %>%
  rename(sun_temperature_c = temperature_c,
         sun_light_lux = light_lux,
         sun_relative_humidity = relative_humidity,
         sun_dew_point_c = dew_point_c) %>% 
  pivot_wider(names_from = height, values_from = c(sun_temperature_c, sun_relative_humidity, sun_dew_point_c, sun_light_lux))%>% 
  select(!c(row, location))

```

